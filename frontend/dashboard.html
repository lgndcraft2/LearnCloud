<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="dashboard-container">
        <!-- Loading State -->
        <div id="loadingState" class="loading-state">
            <div class="spinner"></div>
            <p>Loading your dashboard...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="error-state" style="display: none;">
            <strong>Error:</strong> <span id="errorMessage"></span>
        </div>

        <!-- Main Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Header -->
            <div class="header">
                <div class="welcome-section">
                    <div class="avatar" id="userAvatar">
                        üë§
                    </div>
                    <div class="welcome-text">
                        <h1 id="welcomeMessage">Welcome back!</h1>
                        <p id="lastSeen">Loading...</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="refreshData()">
                        üîÑ Refresh
                    </button>
                    <button class="btn btn-primary" onclick="logout()">
                        üö™ Logout
                    </button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon email">üìß</div>
                    <div class="stat-label">Email Address</div>
                    <div class="stat-value" id="userEmail">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon phone">üì±</div>
                    <div class="stat-label">Phone Number</div>
                    <div class="stat-value" id="userPhone">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon location">üåç</div>
                    <div class="stat-label">Country</div>
                    <div class="stat-value" id="userCountry">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon calendar">üìÖ</div>
                    <div class="stat-label">Member Since</div>
                    <div class="stat-value" id="joinDate">Loading...</div>
                </div>
            </div>

            <!-- Content Grid -->
            <div class="content-grid">
                <div class="main-content">
                    <h2 style="margin-bottom: 1.5rem; color: #1a1a1a;">Account Overview</h2>
                    
                    <div style="background: #f8fafc; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: #374151;">Personal Information</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div>
                                <strong style="color: #667eea;">Full Name:</strong>
                                <div id="fullName" style="margin-top: 0.25rem;">Loading...</div>
                            </div>
                            <div>
                                <strong style="color: #667eea;">User ID:</strong>
                                <div id="userId" style="margin-top: 0.25rem;">Loading...</div>
                            </div>
                            <div>
                                <strong style="color: #667eea;">Account Status:</strong>
                                <div style="margin-top: 0.25rem;">
                                    <span style="background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="quick-actions" id="quick-actions">
                        <!-- <a href="#" class="quick-action">
                            <span class="quick-action-icon" id="courseCode">Loading...</span>
                            <span class="quick-action-text" id="courseName">Loading...</span>
                        </a> -->
                    </div>
                </div>

                <div class="sidebar">
                    <div class="widget">
                        <div class="widget-title">
                            üéØ Quick Stats
                        </div>
                        <div style="text-align: center; padding: 1rem 0;">
                            <div style="font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 0.5rem;">
                                <span id="daysSinceJoined">0</span>
                            </div>
                            <div style="color: #666; font-size: 0.9rem;">Days as a member</div>
                        </div>
                    </div>

                    <div class="widget">
                        <div class="widget-title">
                            üìà Recent Activity
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üîë</div>
                            <div class="activity-content">
                                <div class="activity-title">Account Login</div>
                                <div class="activity-time">Just now</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üìß</div>
                            <div class="activity-content">
                                <div class="activity-title">Email Verified</div>
                                <div class="activity-time" id="verificationDate">Recently</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">üë§</div>
                            <div class="activity-content">
                                <div class="activity-title">Account Created</div>
                                <div class="activity-time" id="creationDate">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
<script>
document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('jwtToken');
    console.log("JWT Token:", token);

    if (!token) {
        alert('No Active User Found. Please log in again.');
        window.location.href = 'C:/Users/LGND/Desktop/Desktop Shii/api playground/frontend/login.html';
        return;
    } else{
        loadDashboardData();
    }


    function loadDashboardData() {
            if (!token) {
                showError('No authentication token available');
                return;
            }

            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('errorState').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'none';

            fetch('https://learncloud-ejbk.onrender.com/api/dashboard', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    userData = data.data;
                    populateDashboard(data.data);
                    let coursesContainer = document.getElementById('quick-actions');
                    coursesContainer.innerHTML = '';
                    if (data.courses && data.courses.length > 0) {
                        data.courses.forEach(course => {
                            const courseItem = document.createElement('a');
                            courseItem.classList.add('quick-action'); // for styling
                            const addedDate = new Date(course.dateAdded);
                            courseItem.innerHTML = `
                                <h3>${course.name} (${course.code})</h3>
                                <p>Units: ${course.units}</p>
                                <p>Level: ${course.level}</p>
                                <p>Added on: ${addedDate.toLocaleDateString()} at ${addedDate.toLocaleTimeString()}</p>
                            `;
                            coursesContainer.appendChild(courseItem);
                        });
                    } else {
                        coursesContainer.innerHTML = '<p>No courses yet.</p>';
                    }

                    showDashboard();
                } else {
                    showError(data.message || 'Failed to load dashboard data');
                    setTimeout(() => {
                        window.location.href = 'C:/Users/LGND/Desktop/Desktop Shii/api playground/frontend/login.html';
                    }, 3000);
                }
            })
            .catch(error => {
                console.error('Dashboard error:', error);
                showError('Network error. Make sure your Flask server is running on http://127.0.0.1:5000');
            });
        }

    function populateDashboard(data) {
        const user = data.user;
        
        // Header section
        document.getElementById('userAvatar').textContent = user.fName.charAt(0).toUpperCase();
        document.getElementById('welcomeMessage').textContent = `Welcome back, ${user.fName}!`;
        
        // Format join date
        const joinDate = new Date(data.joined);
        const formattedDate = joinDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        document.getElementById('lastSeen').textContent = `Member since ${formattedDate}`;

        // Stats cards
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userPhone').textContent = user.phone || 'Not provided';
        document.getElementById('userCountry').textContent = user.country || 'Not specified';
        document.getElementById('joinDate').textContent = formattedDate;

        // Personal info section
        document.getElementById('fullName').textContent = `${user.fName} ${user.lName}`;
        document.getElementById('userId').textContent = `#${user.id}`;

        // Calculate days since joined
        const daysSince = Math.floor((new Date() - joinDate) / (1000 * 60 * 60 * 24));
        document.getElementById('daysSinceJoined').textContent = daysSince;

        // Activity dates
        document.getElementById('creationDate').textContent = formattedDate;
        document.getElementById('verificationDate').textContent = formattedDate;
    }

    function showDashboard() {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('errorState').style.display = 'none';
        document.getElementById('dashboardContent').style.display = 'block';
    }

    function showError(message, hideLoading = true) {
        if (hideLoading) {
            document.getElementById('loadingState').style.display = 'none';
        }
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorState').style.display = 'block';
        document.getElementById('dashboardContent').style.display = 'none';
    }

    function refreshData() {
        loadDashboardData();
    }
    // Attach functions to global scope for button actions
    window.refreshData = refreshData;
    window.logout = logout;

    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('jwtToken');
            userData = null;
            alert('Logged out successfully! In a real app, you would be redirected to the login page.');
            window.location.href = 'C:/Users/LGND/Desktop/Desktop Shii/api playground/frontend/login.html';
        }
    }

    const statCards = document.querySelectorAll('.stat-card');
    statCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px) scale(1.02)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
});
</script>
</body>
</html>